<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0232-simplify-qunit-testing-api - </title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="affix"><a href="introduction.html">Introduction</a></li><li><a href="0001-transform-attribute-meta-parameter.html">0001-transform-attribute-meta-parameter</a></li><li><a href="0003-block-params.html">0003-block-params</a></li><li><a href="0003-cli-ember-doctor.html">0003-cli-ember-doctor</a></li><li><a href="0010-engines.html">0010-engines</a></li><li><a href="0011-improved-cp-syntax.html">0011-improved-cp-syntax</a></li><li><a href="0012-help-json-output.html">0012-help-json-output</a></li><li><a href="0015-the-road-to-ember-2-0.html">0015-the-road-to-ember-2-0</a></li><li><a href="0020-sri-default.html">0020-sri-default</a></li><li><a href="0023-command-line-completion.html">0023-command-line-completion</a></li><li><a href="0024-bound-attributes.html">0024-bound-attributes</a></li><li><a href="0028-app-import-output-file.html">0028-app-import-output-file</a></li><li><a href="0029-addon-black-and-whitelist-for-apps.html">0029-addon-black-and-whitelist-for-apps</a></li><li><a href="0045-internet-explorer.html">0045-internet-explorer</a></li><li><a href="0046-cli-improved-release-process.html">0046-cli-improved-release-process</a></li><li><a href="0046-registry-reform.html">0046-registry-reform</a></li><li><a href="0050-cli-production-code-stripping.html">0050-cli-production-code-stripping</a></li><li><a href="0050-improved-actions.html">0050-improved-actions</a></li><li><a href="0053-helpers.html">0053-helpers</a></li><li><a href="0055-anonymous-amd.html">0055-anonymous-amd</a></li><li><a href="0056-improved-release-cycle.html">0056-improved-release-cycle</a></li><li><a href="0057-ember-data-reference-unification.html">0057-ember-data-reference-unification</a></li><li><a href="0058-helper-listing.html">0058-helper-listing</a></li><li><a href="0061-ember-data-background-fetch.html">0061-ember-data-background-fetch</a></li><li><a href="0064-contextual-component-lookup.html">0064-contextual-component-lookup</a></li><li><a href="0065-deprecation-warning-handlers.html">0065-deprecation-warning-handlers</a></li><li><a href="0080-serve-file-api.html">0080-serve-file-api</a></li><li><a href="0086-firefox-in-ci.html">0086-firefox-in-ci</a></li><li><a href="0090-addon-tree-caching.html">0090-addon-tree-caching</a></li><li><a href="0091-cli-addon-instrumentation-experimental-hooks.html">0091-cli-addon-instrumentation-experimental-hooks</a></li><li><a href="0091-weakmap.html">0091-weakmap</a></li><li><a href="0092-blueprint-remove-old-files.html">0092-blueprint-remove-old-files</a></li><li><a href="0095-cli-standardise-targets.html">0095-cli-standardise-targets</a></li><li><a href="0095-router-service.html">0095-router-service</a></li><li><a href="0096-enable-yarn-usage.html">0096-enable-yarn-usage</a></li><li><a href="0101-ember-data-friendly-errors.html">0101-ember-data-friendly-errors</a></li><li><a href="0105-addons-optionalDependencies.html">0105-addons-optionalDependencies</a></li><li><a href="0108-add-custom-transform.html">0108-add-custom-transform</a></li><li><a href="0110-packaging.html">0110-packaging</a></li><li><a href="0114-add-template-lint-addon.html">0114-add-template-lint-addon</a></li><li><a href="0116-qunit-dom.html">0116-qunit-dom</a></li><li><a href="0120-cli-guides.html">0120-cli-guides</a></li><li><a href="0120-route-serializers.html">0120-route-serializers</a></li><li><a href="0121-remove-ember-cli-eslint.html">0121-remove-ember-cli-eslint</a></li><li><a href="0136-contains-to-includes.html">0136-contains-to-includes</a></li><li><a href="0139-isHtmlSafe.html">0139-isHtmlSafe</a></li><li><a href="0143-module-unification.html">0143-module-unification</a></li><li><a href="0150-factory-for.html">0150-factory-for</a></li><li><a href="0176-javascript-module-api.html">0176-javascript-module-api</a></li><li><a href="0178-deprecate-ember-k.html">0178-deprecate-ember-k</a></li><li><a href="0181-deprecate-ember-data-initializers.html">0181-deprecate-ember-data-initializers</a></li><li><a href="0186-track-unique-history-location-state.html">0186-track-unique-history-location-state</a></li><li><a href="0191-deprecate-component-lifecycle-hook-args.html">0191-deprecate-component-lifecycle-hook-args</a></li><li><a href="0194-deprecate-custom-event-manager.html">0194-deprecate-custom-event-manager</a></li><li><a href="0213-custom-components.html">0213-custom-components</a></li><li><a href="0225-ember-engines-mount-params.html">0225-ember-engines-mount-params</a></li><li><a href="0226-named-blocks.html">0226-named-blocks</a></li><li><a href="0229-deprecate-testing-restricted-resolver.html">0229-deprecate-testing-restricted-resolver</a></li><li><a href="0232-simplify-qunit-testing-api.html" class="active">0232-simplify-qunit-testing-api</a></li><li><a href="0236-deprecation-ember-string.html">0236-deprecation-ember-string</a></li><li><a href="0237-deprecation-ember-map.html">0237-deprecation-ember-map</a></li><li><a href="0240-es-classes.html">0240-es-classes</a></li><li><a href="0252-browser-support-changes.html">0252-browser-support-changes</a></li><li><a href="0268-acceptance-testing-refactor.html">0268-acceptance-testing-refactor</a></li><li><a href="0272-deprecation-native-function-prototype-extensions.html">0272-deprecation-native-function-prototype-extensions</a></li><li><a href="0276-named-args.html">0276-named-args</a></li><li><a href="0278-template-only-components.html">0278-template-only-components</a></li><li><a href="0280-remove-application-wrapper.html">0280-remove-application-wrapper</a></li><li><a href="0281-es5-getters.html">0281-es5-getters</a></li><li><a href="0286-block-let-template-helper.html">0286-block-let-template-helper</a></li><li><a href="0287-promote-in-element-to-public-api.html">0287-promote-in-element-to-public-api</a></li><li><a href="0293-record-data.html">0293-record-data</a></li><li><a href="0294-optional-jquery.html">0294-optional-jquery</a></li><li><a href="0297-deprecate-ember-logger.html">0297-deprecate-ember-logger</a></li><li><a href="0300-rfc-process-update.html">0300-rfc-process-update</a></li><li><a href="0308-deprecate-property-lookup-fallback.html">0308-deprecate-property-lookup-fallback</a></li><li><a href="0311-angle-bracket-invocation.html">0311-angle-bracket-invocation</a></li><li><a href="0318-array-helper.html">0318-array-helper</a></li><li><a href="0322-deprecate-copy-copyable.html">0322-deprecate-copy-copyable</a></li><li><a href="0324-deprecate-component-isvisible.html">0324-deprecate-component-isvisible</a></li><li><a href="0326-ember-data-filter-deprecation.html">0326-ember-data-filter-deprecation</a></li><li><a href="0329-deprecated-ember-evented-in-ember-data.html">0329-deprecated-ember-evented-in-ember-data</a></li><li><a href="0331-deprecate-globals-resolver.html">0331-deprecate-globals-resolver</a></li><li><a href="0332-ember-data-record-links-and-meta.html">0332-ember-data-record-links-and-meta</a></li><li><a href="0335-deprecate-send-action.html">0335-deprecate-send-action</a></li><li><a href="0337-native-class-constructor-update.html">0337-native-class-constructor-update</a></li><li><a href="0340-deprecate-ember-merge.html">0340-deprecate-ember-merge</a></li><li><a href="0345-discord.html">0345-discord</a></li><li><a href="0364-roadmap-2018.html">0364-roadmap-2018</a></li><li><a href="0369-deprecate-computed-clobberability.html">0369-deprecate-computed-clobberability</a></li><li><a href="0370-deprecate-computed-volatile.html">0370-deprecate-computed-volatile</a></li><li><a href="0372-ember-data-model-factory-for.html">0372-ember-data-model-factory-for</a></li><li><a href="0373-Element-Modifier-Managers.html">0373-Element-Modifier-Managers</a></li><li><a href="0375-deprecate-computed-property-modifier.html">0375-deprecate-computed-property-modifier</a></li><li><a href="0386-remove-jquery.html">0386-remove-jquery</a></li><li><a href="0389-dynamic-tag-names.html">0389-dynamic-tag-names</a></li><li><a href="0391-router-helpers.html">0391-router-helpers</a></li><li><a href="0392-deprecate-component-manager-string-lookup.html">0392-deprecate-component-manager-string-lookup</a></li><li><a href="0395-ember-data-packages.html">0395-ember-data-packages</a></li><li><a href="0398-RouteInfo-Metadata.html">0398-RouteInfo-Metadata</a></li><li><a href="0403-ember-data-identifiers.html">0403-ember-data-identifiers</a></li><li><a href="0408-decorators.html">0408-decorators</a></li><li><a href="0410-tracked-properties.html">0410-tracked-properties</a></li><li><a href="0415-render-element-modifiers.html">0415-render-element-modifiers</a></li><li><a href="0416-glimmer-components.html">0416-glimmer-components</a></li><li><a href="0418-deprecate-route-render-methods.html">0418-deprecate-route-render-methods</a></li><li><a href="0421-deprecate-application-controller-props.html">0421-deprecate-application-controller-props</a></li><li><a href="0425-website-redesign.html">0425-website-redesign</a></li><li><a href="0431-guides-restructure.html">0431-guides-restructure</a></li><li><a href="0432-contextual-helpers.html">0432-contextual-helpers</a></li><li><a href="0435-modifier-splattributes.html">0435-modifier-splattributes</a></li><li><a href="0440-decorator-support.html">0440-decorator-support</a></li><li><a href="0445-deprecate-with.html">0445-deprecate-with</a></li><li><a href="0446-contribution-guides.html">0446-contribution-guides</a></li><li><a href="0449-deprecate-partials.html">0449-deprecate-partials</a></li><li><a href="0451-injection-parameter-normalization.html">0451-injection-parameter-normalization</a></li><li><a href="0452-ember-data-medium-term-plan.html">0452-ember-data-medium-term-plan</a></li><li><a href="0457-nested-lookups.html">0457-nested-lookups</a></li><li><a href="0459-angle-bracket-built-in-components.html">0459-angle-bracket-built-in-components</a></li><li><a href="0460-yieldable-named-blocks.html">0460-yieldable-named-blocks</a></li><li><a href="0461-ember-data-singleton-record-data.html">0461-ember-data-singleton-record-data</a></li><li><a href="0463-record-data-state.html">0463-record-data-state</a></li><li><a href="0465-record-data-errors.html">0465-record-data-errors</a></li><li><a href="0466-request-state-service.html">0466-request-state-service</a></li><li><a href="0468-classic-decorator.html">0468-classic-decorator</a></li><li><a href="0470-fn-helper.html">0470-fn-helper</a></li><li><a href="0471-on-modifier.html">0471-on-modifier</a></li><li><a href="0478-tracked-properties-updates.html">0478-tracked-properties-updates</a></li><li><a href="0481-component-templates-co-location.html">0481-component-templates-co-location</a></li><li><a href="0486-deprecate-mouseenter.html">0486-deprecate-mouseenter</a></li><li><a href="0487-custom-model-classes.html">0487-custom-model-classes</a></li><li><a href="0491-deprecate-disconnect-outlet.html">0491-deprecate-disconnect-outlet</a></li><li><a href="0494-async-observers.html">0494-async-observers</a></li><li><a href="0521-find-by-identifier.html">0521-find-by-identifier</a></li><li><a href="0522-default-serializers-and-adapters.html">0522-default-serializers-and-adapters</a></li><li><a href="0523-model-argument-for-route-templates.html">0523-model-argument-for-route-templates</a></li><li><a href="0554-deprecate-getwithdefault.html">0554-deprecate-getwithdefault</a></li><li><a href="0558-edition-detection.html">0558-edition-detection</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title"></h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li>Start Date: 2017-06-13</li>
<li>RFC PR: <a href="https://github.com/emberjs/rfcs/pull/232">emberjs/rfcs#232</a></li>
<li>Ember Issue: (leave this empty)</li>
</ul>
<h1><a class="header" href="#summary" id="summary">Summary</a></h1>
<p>In order to embrace newer features being added by QUnit (our chosen default
testing framework), we need to reduce the brittle coupling between <code>ember-qunit</code>
and QUnit itself. </p>
<p>This RFC proposes a new testing syntax, that will expose QUnit API directly while
also making tests much easier to understand. </p>
<h1><a class="header" href="#motivation" id="motivation">Motivation</a></h1>
<p>QUnit feature development has been accelerating since the ramp up to QUnit 2.0.
A number of new features have been added that make testing our applications
much easier, but the current structure of <code>ember-qunit</code> impedes our ability 
to take advantage of some of these features.</p>
<p>Developers are often confused by our <code>moduleFor*</code> APIs, questions like these
are very common: </p>
<ul>
<li>What &quot;magic&quot; is <code>ember-qunit</code> doing? </li>
<li>Where are the lines between QUnit and ember-qunit? </li>
<li>How can I use QUnit for plain JS objects? </li>
</ul>
<p>The way that <code>ember-qunit</code> wraps QUnit functionality makes the division
of responsiblity much harder to understand, and leads folks to believe that there
is much more going on in <code>ember-qunit</code> than there is. It should be much clearer
what <code>ember-qunit</code> is responsible for and what we rely on QUnit for.</p>
<p>This RFC also aims to remove a number of custom testing only APIs that exist today
(largely because the container/registry system was completely private when the
current tools were authored). Instead of things like <code>this.subject</code>, <code>this.register</code>,
<code>this.inject</code>, or <code>this.lookup</code> we can rely on the standard way of performing these
functions in Ember via the owner API.</p>
<p>When this RFC has been implemented and rolled out, these questions should all be
addressed and our testing system will both: embrace QUnit much more <strong>and</strong> 
be much more framework agnostic, all the while dropping custom testing only APIs
in favor of public APIs that work across tests and app code.</p>
<p>Sounds like a neat trick, huh?</p>
<h1><a class="header" href="#detailed-design" id="detailed-design">Detailed design</a></h1>
<p>The primary change being proposed in this RFC is to migrate to using the QUnit
nested module syntax, and update our custom setup/teardown into a more functional
API.</p>
<p>Lets look at a basic example:</p>
<pre><code class="language-js">// **** before ****

import { moduleForComponent, test } from 'ember-qunit';
import hbs from 'htmlbars-inline-precompile';

moduleForComponent('x-foo', {
  integration: true
});

test('renders', function(assert) {
  assert.expect(1);

  this.render(hbs`{{pretty-color name=&quot;red&quot;}}`);

  assert.equal(this.$('.color-name').text(), 'red');
});

// **** after ****

import { module, test } from 'qunit';
import { setupRenderingTest } from 'ember-qunit';
import hbs from 'htmlbars-inline-precompile';

module('x-foo', function(hooks) {
  setupRenderingTest(hooks);

  test('renders', async function(assert) {
    assert.expect(1);

    await this.render(hbs`{{pretty-color name=&quot;red&quot;}}`);

    assert.equal(this.$('.color-name').text(), 'red');
  });
});
</code></pre>
<p>As you can see, this proposal leverages QUnit's nested module API in a way that
makes it much clearer what is going on. It is quite obvious what QUnit is doing
(acting like a general testing framework) and what <code>ember-qunit</code> is doing 
(setting up rendering functionality).</p>
<p>This API was heavily influenced by the work that 
<a href="https://github.com/Turbo87">Tobias Bieniek</a> did in 
<a href="https://github.com/emberjs/ember-mocha/pull/84">emberjs/ember-mocha#84</a>.</p>
<h2><a class="header" href="#qunit-nested-modules-api" id="qunit-nested-modules-api">QUnit Nested Modules API</a></h2>
<p>Even though it is not a proposal of this RFC, the QUnit nested module
syntax may seem foreign to some folks so lets briefly review.</p>
<p>With nested modules, a normal 1.x QUnit module setup changes from:</p>
<pre><code class="language-js">QUnit.module('some description', {
  before() {},
  beforeEach() {},
  afterEach() {},
  after() {}
});

QUnit.test('it blends', function(assert) {
  assert.ok(true, 'of course!');
});
</code></pre>
<p>Into:</p>
<pre><code class="language-js">QUnit.module('some description', function(hooks) {

  hooks.before(() =&gt; {});
  hooks.beforeEach(() =&gt; {});
  hooks.afterEach(() =&gt; {});
  hooks.after(() =&gt; {});

  QUnit.test('it blends', function(assert) {
    assert.ok(true, 'of course!');
  });
});
</code></pre>
<p>This makes it much simpler to support multiple <code>before</code>, <code>beforeEach</code>, <code>afterEach</code>,
and <code>after</code> callbacks, and it also allows for arbitrary nesting of modules.</p>
<p>You can read more about QUnit nested modules
<a href="http://api.qunitjs.com/QUnit/module#nested-module-nested-hooks-">here</a>. The new APIs
proposed in this RFC expect to be leveraging nested modules. </p>
<h2><a class="header" href="#new-apis" id="new-apis">New APIs</a></h2>
<p>The following new methods will be exposed from <code>ember-qunit</code>:</p>
<pre><code class="language-ts">interface QUnitModuleHooks {
  before(callback: Function): void;
  beforeEach(callback: Function): void;
  afterEach(callback: Function): void;
  after(callback: Function): void;
}

declare module 'ember-qunit' {
  // ...snip... 
  export function setupTest(hooks: QUnitModuleHooks): void;
  export function setupRenderingTest(hooks: QUnitModuleHooks): void;
}
</code></pre>
<h3><a class="header" href="#setuptest" id="setuptest"><code>setupTest</code></a></h3>
<p>This function will:</p>
<ul>
<li>invoke <code>ember-test-helper</code>s <code>setContext</code> with the tests context</li>
<li>create an owner object and set it on the test context (e.g. <code>this.owner</code>)</li>
<li>setup <code>this.set</code>, <code>this.setProperties</code>, <code>this.get</code>, and <code>this.getProperties</code> to
the test context</li>
<li>setup <code>this.pauseTest</code> and <code>this.resumeTest</code> methods to allow easy pausing/resuming
of tests</li>
</ul>
<h3><a class="header" href="#setuprenderingtest" id="setuprenderingtest"><code>setupRenderingTest</code></a></h3>
<p>This function will:</p>
<ul>
<li>run the <code>setupTest</code> implementation</li>
<li>setup <code>this.$</code> method to run jQuery selectors rooted to the testing container </li>
<li>setup a getter for <code>this.element</code> which returns the DOM element representing
the element that was rendered via <code>this.render</code></li>
<li>setup Ember's renderer and create a <code>this.render</code> method which accepts a 
compiled template to render and returns a promise which resolves once rendering
is completed</li>
<li>setup <code>this.clearRender</code> method which clears any previously rendered DOM (
also used during cleanup)</li>
</ul>
<p>When invoked, <code>this.render</code> will render the provided template and return a
promise that resolves when rendering is completed.</p>
<h2><a class="header" href="#changes-from-current-system" id="changes-from-current-system">Changes from Current System</a></h2>
<p>Here is a brief list of the more important but possibly understated changes
being proposed here:</p>
<ul>
<li>the various setup methods no longer need to know the name of the object under test</li>
<li><code>this.subject</code> is removed in favor of using the standard public API for looking up
and creating instances (<code>this.owner.lookup</code> and <code>this.owner.factoryFor</code>)</li>
<li><code>this.inject</code> is removed in favor of using <code>this.owner.lookup</code> directly</li>
<li><code>this.register</code> is removed in favor of using <code>this.owner.register</code> directly</li>
<li><code>this.render</code> will begin being asynchronous to allow for further iteration in the
underlying rendering engines ability to speed up render times (by yielding back
to the browser and not blocking the main thread)</li>
<li><code>this.pauseTest</code> and <code>this.resumeTest</code> are being added</li>
<li><code>this.element</code> is being introduced as a public API for DOM assertions in a jQuery-less
environment</li>
<li>QUnit nested modules are required</li>
</ul>
<p>These changes generally do not affect our ability to write a codemod to aide in the migration.</p>
<h2><a class="header" href="#migration-examples" id="migration-examples">Migration Examples</a></h2>
<p>The migration can likely be largely automated (following the 
<a href="https://github.com/Turbo87/ember-mocha-codemods">excellent codemod</a> that 
<a href="https://github.com/turbo87">Tobias Bieniek</a> wrote for a similar <code>ember-mocha</code>
the transition), but it is still useful to review concrete scenarios
of tests before and after this RFC is implemented.</p>
<h3><a class="header" href="#component--helper-integration-test" id="component--helper-integration-test">Component / Helper Integration Test</a></h3>
<pre><code class="language-js">// **** before ****

import { moduleForComponent, test } from 'ember-qunit';
import hbs from 'htmlbars-inline-precompile';

moduleForComponent('x-foo', {
  integration: true
});

test('renders', function(assert) {
  assert.expect(1);

  this.render(hbs`{{pretty-color name=&quot;red&quot;}}`);

  assert.equal(this.$('.color-name').text(), 'red');
});

// **** after ****

import { module, test } from 'qunit';
import { setupRenderingTest } from 'ember-qunit';
import hbs from 'htmlbars-inline-precompile';

module('x-foo', function(hooks) {
  setupRenderingTest(hooks);

  test('renders', async function(assert) {
    assert.expect(1);

    await this.render(hbs`{{pretty-color name=&quot;red&quot;}}`);

    assert.equal(this.$('.color-name').text(), 'red');
  });
});
</code></pre>
<h3><a class="header" href="#component-unit-test" id="component-unit-test">Component Unit Test</a></h3>
<pre><code class="language-js">// **** before ****

import { moduleForComponent, test } from 'ember-qunit';

moduleForComponent('x-foo', {
  unit: true
});

test('computes properly', function(assert) {
  assert.expect(1);

  let subject = this.subject({
    name: 'something'
  });

  let result = subject.get('someCP');
  assert.equal(result, 'expected value');
});

// **** after ****

import { module, test } from 'qunit';
import { setupTest } from 'ember-qunit';

module('x-foo', function(hooks) {
  setupTest(hooks);

  test('computed properly', function(assert) {
    assert.expect(1);

    let Factory = this.owner.factoryFor('component:x-foo');
    let subject = Factory.create({
      name: 'something'
    });

    let result = subject.get('someCP');
    assert.equal(result, 'expected value');
  });
});
</code></pre>
<h3><a class="header" href="#serviceroutecontroller-test" id="serviceroutecontroller-test">Service/Route/Controller Test</a></h3>
<pre><code class="language-js">// **** before ****

import { moduleFor, test } from 'ember-qunit';

moduleFor('service:flash', 'Unit | Service | Flash', {
  unit: true
});

test('should allow messages to be queued', function (assert) {
  assert.expect(4);
  
  let subject = this.subject();
  
  subject.show('some message here');
  
  let messages = subject.messages;
  
  assert.deepEqual(messages, [
    'some message here'
  ]);
});

// **** after ****

import { module, test } from 'qunit';
import { setupTest } from 'ember-qunit';

module('Unit | Service | Flash', function(hooks) {
  setupTest(hooks);
  
  test('should allow messages to be queued', function (assert) {
    assert.expect(4);
  
    let subject = this.owner.lookup('service:flash');
  
    subject.show('some message here');
  
    let messages = subject.messages;
  
    assert.deepEqual(messages, [
      'some message here'
    ]);
  });
});

</code></pre>
<h2><a class="header" href="#ecosystem-updates" id="ecosystem-updates">Ecosystem Updates</a></h2>
<p>The blueprints in all official projects (and any provided by popular addons) 
will need to be updated to detect <code>ember-qunit</code> version and emit the correct
output.</p>
<p>This includes:</p>
<ul>
<li>ember-source</li>
<li>ember-data</li>
<li>ember-cli-legacy-blueprints</li>
<li>others?</li>
</ul>
<p>This exact process was done for <code>ember-mocha</code>'s migration, making this a well
trodden path.</p>
<h2><a class="header" href="#update-guides" id="update-guides">Update Guides</a></h2>
<p>The guides includes a section for testing, this section needs to be reviewed
and revamped to match the proposal here.</p>
<h2><a class="header" href="#deprecate-older-apis" id="deprecate-older-apis">Deprecate older APIs</a></h2>
<p>Once this RFC is implemented, the older APIs will be deprecated and retained 
for a full LTS cycle (assuming speedy landing, this would mean the older APIs 
would be deprecated around Ember 2.20). After that timeframe, the older APIs
will be removed from <code>ember-qunit</code> and <code>ember-test-helpers</code> and they will
release with SemVer major version bumps.</p>
<p>Note that while the older <code>moduleFor</code> and <code>moduleForComponent</code> APIs will be
deprecated, they will still be possible to use since the host application can
pin to a version of <code>ember-qunit</code> / <code>ember-test-helpers</code> that support its own
usage. This is a large benefit of migrating these testing features away from 
<code>Ember</code>'s internals, and into the addon space.</p>
<h2><a class="header" href="#relationship-to-grand-testing-unification" id="relationship-to-grand-testing-unification">Relationship to &quot;Grand Testing Unification&quot;</a></h2>
<p>This RFC is a small stepping stone towards the future where all types of tests
share a similar API. The API proposed here is much easier to extend to provide
the functionality that is required for <a href="https://github.com/emberjs/rfcs/pull/119">emberjs/rfcs#119</a>.</p>
<h1><a class="header" href="#how-we-teach-this" id="how-we-teach-this">How We Teach This</a></h1>
<p>This change requires updates to the API documentation of <code>ember-qunit</code> and the
main Ember guides' testing section. The changes are largely intended to reduce
confusion, making it easier to teach and understand testing in Ember.</p>
<h1><a class="header" href="#drawbacks" id="drawbacks">Drawbacks</a></h1>
<h2><a class="header" href="#churn" id="churn">Churn</a></h2>
<p>As mentioned in <a href="https://github.com/emberjs/rfcs/pull/229">emberjs/rfcs#229</a>, test
related churn is quite painful and annoying. In order to maintain the general
goodwill of folks, we must ensure that we avoid needless churn. </p>
<p>This RFC should be implemented in conjunction with 
<a href="https://github.com/emberjs/rfcs/pull/229">emberjs/rfcs#229</a> so that we can avoid
multiple back to back changes in the blueprints.</p>
<h2><a class="header" href="#a-hrefhttpsgithubcomqunitjsqunitissues977qunitjsqunit977a" id="a-hrefhttpsgithubcomqunitjsqunitissues977qunitjsqunit977a"><a href="https://github.com/qunitjs/qunit/issues/977">qunitjs/qunit#977</a></a></h2>
<p>Until very recently, the QUnit nested module API was only able to allow a single
callback for each of the hooks per-nesting level. This means that the proposal in
this RFC (which requires the hooks to be setup by <code>ember-qunit</code>) would disallow
user-land <code>beforeEach</code>/<code>afterEach</code> hooks to be setup.</p>
<p>The work around is &quot;simple&quot; (if somewhat annoying), which is to &quot;just nest another
level&quot;. The good news is that <a href="https://github.com/trentwillis">Trent Willis</a> fixed
the underlying problem in <a href="https://github.com/qunitjs/qunit/pull/1188">qunitjs/qunit#1188</a>,
which should be released as 2.3.4 well before this RFC is merged.</p>
<h1><a class="header" href="#alternatives" id="alternatives">Alternatives</a></h1>
<p>The simplest alternative is to do nothing. This would loose all of the positive
benefits mentioned in this RFC, but should still be considered a possibility...</p>
<h1><a class="header" href="#unanswered-questions" id="unanswered-questions">Unanswered Questions</a></h1>
<h2><a class="header" href="#hooks-argument" id="hooks-argument"><code>hooks</code> argument</a></h2>
<p>A few folks (e.g. <a href="https://github.com/ebryn">@ebryn</a> and <a href="https://github.com/stefanpenner">@stefanpenner</a>)
have approached me with concerns around the <code>hooks</code> argument I have mentioned/used here. The concerns
are generally an initial reaction to the QUnit nested modules API in general and not directly related
to this RFC (other than it highlighting a new feature that they haven't used before).</p>
<p>The main concerns are:</p>
<ul>
<li>Teaching folks what <code>hooks</code> means is a bit more difficult because it does not represent the &quot;test
environment&quot;, but rather just a way to invoke the callbacks for <code>before</code> / <code>beforeEach</code> / <code>after</code> /
<code>afterEach</code>.</li>
<li>Passing only <code>hooks</code> to the helper functions proposed in the RFC means that if we ever need to thread
more information through, we either have to use <code>hooks</code> as a transport or change our API to add more
arguments.</li>
<li>It seems somewhat impossible to communicate across multiple helpers (again without using <code>hooks</code>
as a state/transport mechanism).</li>
</ul>
<p>I've kicked off a conversation over with the QUnit folks in https://github.com/qunitjs/qunit/issues/1200.
If that PR were merged this proposal would be modified to the following syntax:</p>
<pre><code class="language-js">// current proposal
module('x-foo', function(hooks) {
  setupRenderingTest(hooks);
  // ....snip....
});

// after qunitjs/qunit#1200
module('x-foo', function(hooks) {
  setupRenderingTest(this);
  // ....snip....
});
</code></pre>
<p>Another possible solution is to rename the argument (here and in the blueprints) to <code>module</code>.
This is more in line with what the QUnit folks view it as: the &quot;module context&quot; that
is being created for that specific <code>QUnit.module</code> invocation.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="0229-deprecate-testing-restricted-resolver.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="0236-deprecation-ember-string.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="0229-deprecate-testing-restricted-resolver.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="0236-deprecation-ember-string.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
